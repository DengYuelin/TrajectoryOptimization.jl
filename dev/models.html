<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>1. Setting up a Dynamics Model · TrajectoryOptimization</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">TrajectoryOptimization</span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Introduction</a></li><li><span class="tocitem">Getting Started</span><ul><li class="is-active"><a class="tocitem" href="models.html">1. Setting up a Dynamics Model</a><ul class="internal"><li><a class="tocitem" href="#Overview-1"><span>Overview</span></a></li><li><a class="tocitem" href="#Creating-a-New-Model-1"><span>Creating a New Model</span></a></li><li><a class="tocitem" href="#Time-varying-systems-(experimental)-1"><span>Time-varying systems (experimental)</span></a></li><li><a class="tocitem" href="#Models-with-3D-Rotations-(experimental)-1"><span>Models with 3D Rotations (experimental)</span></a></li></ul></li><li><a class="tocitem" href="costfunctions.html">2. Setting up an Objective</a></li><li><a class="tocitem" href="constraints.html">3. Creating Constraints</a></li><li><a class="tocitem" href="problem.html">4. Setting up a Problem</a></li></ul></li><li><span class="tocitem">Documentation</span><ul><li><a class="tocitem" href="discretization.html">Discretizaation</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Getting Started</a></li><li class="is-active"><a href="models.html">1. Setting up a Dynamics Model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="models.html">1. Setting up a Dynamics Model</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/master/docs/src/models.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="model_section-1"><a class="docs-heading-anchor" href="#model_section-1">1. Setting up a Dynamics Model</a><a class="docs-heading-anchor-permalink" href="#model_section-1" title="Permalink"></a></h1><ul><li><a href="models.html#model_section-1">1. Setting up a Dynamics Model</a></li><ul><li><a href="models.html#Overview-1">Overview</a></li><li><a href="models.html#Creating-a-New-Model-1">Creating a New Model</a></li><li><a href="models.html#Time-varying-systems-(experimental)-1">Time-varying systems (experimental)</a></li><li><a href="models.html#Models-with-3D-Rotations-(experimental)-1">Models with 3D Rotations (experimental)</a></li></ul></ul><h2 id="Overview-1"><a class="docs-heading-anchor" href="#Overview-1">Overview</a><a class="docs-heading-anchor-permalink" href="#Overview-1" title="Permalink"></a></h2><p>The Model type holds information about the dynamics of the system. All dynamics are assumed to be state-space models of the system of the form <span>$\dot{x} = f(x,u)$</span> where <span>$\dot{x}$</span> is the state derivative, <span>$x$</span> an <span>$n$</span>-dimensional state vector, and <span>$u$</span> in an <span>$m$</span>-dimensional control input vector. The function <span>$f$</span> can be any nonlinear function.</p><p>TrajectoryOptimization.jl solves the trajectory optimization problem by discretizing the state and control trajectories, which requires discretizing the dynamics, i.e., turning the continuous time differential equation into a discrete time difference equation of the form <span>$x[k+1] = f(x[k],u[k])$</span>, where <span>$k$</span> is the time step. There many methods of performing this discretization, and TrajectoryOptimization.jl offers several of the most common methods. See <a href="discretization.html#Model-Discretization-1">Model Discretization</a> section for more information on discretizing dynamics, as well as how to define custom integration methods.</p><h2 id="Creating-a-New-Model-1"><a class="docs-heading-anchor" href="#Creating-a-New-Model-1">Creating a New Model</a><a class="docs-heading-anchor-permalink" href="#Creating-a-New-Model-1" title="Permalink"></a></h2><p>To create a new model of a dynamical system, you need to define a new type that inherits from <code>AbstractModel</code>. You will need to then define only a few methods on your type. Let&#39;s say we want to create a model of the canonical cartpole. We start by defining our type:</p><pre><code class="language-julia">struct Cartpole{T} &lt;: AbstractModel
    mc::T  # mass of the cart
    mp::T  # mass of the pole
    l::T   # length of the pole
    g::T   # gravity
end</code></pre><p>It&#39;s often convenient to store any model parameters inside the new type (make sure they&#39;re concrete types!). If you need to store vectors or matrices, we highly recommend using StaticArrays, which are extremely fast and avoid memory allocations. For models with lots of parameters, we recommend <a href="https://github.com/mauro3/Parameters.jl">Parameters.jl</a> that makes it easy to specify default parameters.</p><p>We now just need to define two functions to complete the interface</p><pre><code class="language-julia">import TrajectoryOptimization: dynamics  # the dynamics function must be imported

function dynamics(model::Cartpole, x, u)
    mc = model.mc  # mass of the cart in kg (10)
    mp = model.mp   # mass of the pole (point mass at the end) in kg
    l = model.l   # length of the pole in m
    g = model.g  # gravity m/s^2

    q = x[ @SVector [1,2] ]
    qd = x[ @SVector [3,4] ]

    s = sin(q[2])
    c = cos(q[2])

    H = @SMatrix [mc+mp mp*l*c; mp*l*c mp*l^2]
    C = @SMatrix [0 -mp*qd[2]*l*s; 0 0]
    G = @SVector [0, mp*g*l*s]
    B = @SVector [1, 0]

    qdd = -H\(C*qd + G - B*u[1])
    return [qd; qdd]
end

Base.size(::Cartpole) = 4,1</code></pre><p>And voila! we have a new model.</p><p>We now have a few methods automatically available to us:</p><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.dynamics" href="#TrajectoryOptimization.dynamics"><code>TrajectoryOptimization.dynamics</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">ẋ = dynamics(model, z::KnotPoint)</code></pre><p>Compute the continuous dynamics of a dynamical system given a KnotPoint</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/ae02c158963ecff96629bd5bc9acf5ec71f69261/src/static_model.jl#L76-L80">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.jacobian" href="#TrajectoryOptimization.jacobian"><code>TrajectoryOptimization.jacobian</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">∇f = jacobian(model, z::KnotPoint)
∇f = jacobian(model, z::SVector)</code></pre><p>Compute the Jacobian of the continuous-time dynamics using ForwardDiff. The input can be either a static vector of the concatenated state and control, or a KnotPoint. They must be concatenated to avoid unnecessary memory allocations.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/ae02c158963ecff96629bd5bc9acf5ec71f69261/src/static_model.jl#L85-L93">source</a></section></article><h2 id="Time-varying-systems-(experimental)-1"><a class="docs-heading-anchor" href="#Time-varying-systems-(experimental)-1">Time-varying systems (experimental)</a><a class="docs-heading-anchor-permalink" href="#Time-varying-systems-(experimental)-1" title="Permalink"></a></h2><p>TrajectoryOptimization.jl also offers experimental support for time-varying systems. Let&#39;s say for some reason the mass of our cartpole is decreasing linearly with time. We can model this with a slight modification to the dynamics function signature:</p><pre><code class="language-julia">import TrajectoryOptimization: dynamics

struct CartpoleTimeVarying{T} &lt;: AbstractModel
    mc::T  # initial mass of the cart
    mp::T  # mass of the pole
    l::T   # length of the pole
    g::T   # gravity
end

function dynamics(model::CartpoleTimeVarying, x, u, t)  # note extra time parameter
    mc = model.mc  # mass of the cart in kg (10)
    mp = model.mp   # mass of the pole (point mass at the end) in kg
    l = model.l   # length of the pole in m
    g = model.g  # gravity m/s^2

    # Change the mass of the cart with time
    mc = mc - 0.01*t

    q = x[ @SVector [1,2] ]
    qd = x[ @SVector [3,4] ]

    s = sin(q[2])
    c = cos(q[2])

    H = @SMatrix [mc+mp mp*l*c; mp*l*c mp*l^2]
    C = @SMatrix [0 -mp*qd[2]*l*s; 0 0]
    G = @SVector [0, mp*g*l*s]
    B = @SVector [1, 0]

    qdd = -H\(C*qd + G - B*u[1])
    return [qd; qdd]
end

Base.size(::CartpoleTimeVarying) = 4,1</code></pre><h2 id="Models-with-3D-Rotations-(experimental)-1"><a class="docs-heading-anchor" href="#Models-with-3D-Rotations-(experimental)-1">Models with 3D Rotations (experimental)</a><a class="docs-heading-anchor-permalink" href="#Models-with-3D-Rotations-(experimental)-1" title="Permalink"></a></h2><p>TrajectoryOptimization.jl offers experimental support for models with non-Euclidean state vectors, such as 3D rotations, which live in <span>$SO(3)$</span> instead of <span>$\mathbb^4$</span>. See <a href="@ref">RigidBody</a> section for more details.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="index.html">« Introduction</a><a class="docs-footer-nextpage" href="costfunctions.html">2. Setting up an Objective »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 24 December 2019 12:55">Tuesday 24 December 2019</span>. Using Julia version 1.2.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
