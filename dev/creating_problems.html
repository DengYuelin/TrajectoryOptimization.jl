<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>4. Setting up a Problem · TrajectoryOptimization</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">TrajectoryOptimization</span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Introduction</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="models.html">1. Setting up a Dynamics Model</a></li><li><a class="tocitem" href="costfunctions.html">2. Setting up an Objective</a></li><li><a class="tocitem" href="constraints.html">3. Creating Constraints</a></li><li class="is-active"><a class="tocitem" href="creating_problems.html">4. Setting up a Problem</a><ul class="internal"><li><a class="tocitem" href="#Creating-a-Problem-1"><span>Creating a Problem</span></a></li><li><a class="tocitem" href="#Initialization-1"><span>Initialization</span></a></li><li><a class="tocitem" href="#KnotPoint-Type-1"><span><code>KnotPoint</code> Type</span></a></li><li><a class="tocitem" href="#Traj-Type-1"><span><code>Traj</code> Type</span></a></li></ul></li><li><a class="tocitem" href="solving.html">5. Solving the Problem</a></li></ul></li><li><span class="tocitem">Interfaces</span><ul><li><a class="tocitem" href="costfunction_interface.html">Cost Function Interface</a></li><li><a class="tocitem" href="constraint_interface.html">Constraint Interface</a></li><li><a class="tocitem" href="solver_interface.html">Solver Interface</a></li></ul></li><li><span class="tocitem">Documentation</span><ul><li><a class="tocitem" href="model_types.html">Model Types</a></li><li><a class="tocitem" href="discretization.html">Discretization</a></li><li><a class="tocitem" href="cost_api.html">Cost Functions and Objectives</a></li><li><a class="tocitem" href="constraint_api.html">Constraints</a></li><li><a class="tocitem" href="problem.html">Problem</a></li><li><a class="tocitem" href="solvers.html">Solvers</a></li><li><a class="tocitem" href="rotations.html">Rotations</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Getting Started</a></li><li class="is-active"><a href="creating_problems.html">4. Setting up a Problem</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="creating_problems.html">4. Setting up a Problem</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/master/docs/src/creating_problems.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="problem_section-1"><a class="docs-heading-anchor" href="#problem_section-1">4. Setting up a Problem</a><a class="docs-heading-anchor-permalink" href="#problem_section-1" title="Permalink"></a></h1><p>The <a href="problem.html#TrajectoryOptimization.Problem"><code>Problem</code></a> contains all of the information needed to solve a trajectory optimization problem. At a minimum, this is the model, objective, and initial condition. A <code>Problem</code> is passed to a solver, which extracts needed information, and may or may or not modify its internal representation of the problem in order to solve it (e.g. the Augmented Lagrangian solver combines the constraints and objective into a single Augmented Lagrangian objective.)</p><h2 id="Creating-a-Problem-1"><a class="docs-heading-anchor" href="#Creating-a-Problem-1">Creating a Problem</a><a class="docs-heading-anchor-permalink" href="#Creating-a-Problem-1" title="Permalink"></a></h2><p>Let&#39;s say we&#39;re trying to solve the following trajectory optimization problem:</p><div>\[\begin{aligned}
  \min_{x_{0:N},u_{0:N-1}} \quad &amp; (x_N-x_f)^T Q_f (x_N-x_f) + dt \sum_{k=0}^{N-1} (x_k-x_f)^T Q (x_k - x_f) + u^T R u  \\
  \textrm{s.t.}            \quad &amp; x_{k+1} = f(x_k, u_k), \\
                                 &amp; |u_k| \leq 3 \\
                                 &amp; x_N = x_f \\
\end{aligned}\]</div><p>We&#39;ll quickly set up the dynamics, objective, and constraints. See previous sections for more details on how to do this.</p><pre><code class="language-julia"># Dynamics and Constants
model = Dynamics.Cartpole()
n,m = size(model)
N = 101   # number of knot points
tf = 5.0  # final time
x0 = @SVector[0.0, 0.0]  # initial state
xf = @SVector [0, π]     # goal state (i.e. swing up)

# Objective
Q = Diagonal(@SVector fill(1e-2,n))
R = Diagonal(@SVector fill(1e-1,m))
Qf = Diagonal(@SVector fill(100,n))
obj = LQRObjective(Q, R, Qf, xf, N)

# Constraints
conSet = ConstraintSet(n,m,N)
bnd = BoundConstraint(n,m, u_min=-3.0, u_max=3.0)
goal = GoalConstraint(xf)
add_constraint!(conSet, bnd, 1:N-1)
add_constraint!(conSet, goal, N:N)</code></pre><p>The following method is the easiest way to set up a trajectory optimization problem:</p><pre><code class="language-julia">prob = Problem(model, obj, xf, tf, constraints=conSet, x0=x0, integration=RK3)</code></pre><p>where the keyword arguments are, of course, optional.</p><p>This constructor has the following arguments:</p><ul><li>(required) <code>model::AbstractModel</code> - dynamics model</li><li>(required) <code>obj::AbstractObjective</code> - objective function</li><li>(required) <code>xf::AbstractVector</code> - goal state (this will be made optional in the near future)</li><li>(required) <code>tf::AbstractFloat</code> - final time</li><li>(optional) <code>constraints::ConstraintSet</code> - constraint set. Default is no constraints.</li><li>(optional) <code>x0::AbstractVector</code> - Initial state. Default is the zero vector.</li><li>(optional) <code>N::Int</code> - number of knot points. Default is given by length of objective.</li><li>(optional) <code>dt::AbstractFloat</code> - Time step length. Can be either a scalar or a vector of length <code>N</code>. Default is calculated using <code>tf</code> and <code>N</code>.</li><li>(optional) <code>integration::Type{&lt;:QuadratureRule}</code> - Quadrature rule for discretizing the dynamics. Default is given by <code>TrajectoryOptimization.DEFAULT_Q</code>.</li><li>(optional) <code>X0</code> - Initial guess for state trajectory. Can either be a matrix of size <code>(n,N)</code> or a vector of length <code>N</code> of <code>n</code>-dimensional vectors.</li><li>(optional) <code>U0</code> - Initial guess for control trajectory. Can either be a matrix of size <code>(m,N)</code> or a vector of length <code>N-1</code> of <code>n</code>-dimensional vectors.</li></ul><h2 id="Initialization-1"><a class="docs-heading-anchor" href="#Initialization-1">Initialization</a><a class="docs-heading-anchor-permalink" href="#Initialization-1" title="Permalink"></a></h2><p>A good initialization is critical to getting good results for nonlinear optimization problems. TrajectoryOptimization.jl current supports initialization of the state and control trajectories. Initialization of dual variables (i.e. Lagrange multipliers) is not yet support but will be included in the near future. The state and control trajectories can be initialized directly in the constructor using the <code>X0</code> and <code>U0</code> keyword arguments described above, or using the following methods:</p><pre><code class="language-julia">initial_states!(prob, X0)
initial_controls!(prob, U0)</code></pre><p>where, again, these can either be matrices or vectors of vectors of the appropriate size. It should be noted that these methods work on either <code>Problem</code>s or instances of <code>AbstractSolver</code>.</p><p>Alternatively, the problem can be initialized with both the state and control trajectories simultaneously by passing in a vector of <a href="creating_problems.html#TrajectoryOptimization.KnotPoint"><code>KnotPoint</code></a>s, described in the next sections.</p><h2 id="KnotPoint-Type-1"><a class="docs-heading-anchor" href="#KnotPoint-Type-1"><code>KnotPoint</code> Type</a><a class="docs-heading-anchor-permalink" href="#KnotPoint-Type-1" title="Permalink"></a></h2><p>Internally, TrajectoryOptimization.jl stores the state and controls at each time step as a concatenated vector inside of a custom <code>KnotPoint</code> type. In addition to storing the state and control, the <code>KnotPoint</code> type also stores the time and time step length for the current knot point.  </p><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.KnotPoint" href="#TrajectoryOptimization.KnotPoint"><code>TrajectoryOptimization.KnotPoint</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">mutable struct KnotPoint{T, N, M, NM}</code></pre><p>Stores critical information corresponding to each knot point in the trajectory optimization problem, including the state and control values, as well as the time and time step length.</p><p><strong>Getters</strong></p><p>Use the following methods to access values from a <code>KnotPoint</code>:</p><pre><code class="language-julia">x  = state(z::KnotPoint)    # returns the n-dimensional state as a SVector
u  = control(z::KnotPoint)  # returns the m-dimensional control vector as a SVector
t  = z.t                    # current time
dt = z.dt                   # time step length</code></pre><p><strong>Setters</strong></p><p>Use the following methods to set values in a <code>KnotPoint</code>:</p><pre><code class="language-julia">set_state!(z::KnotPoint, x)
set_control!(z::KnotPoint, u)
z.t = t
z.dt = dt</code></pre><p><strong>Constructors</strong></p><pre><code class="language-julia">KnotPoint(x, u, dt, t=0.0)
KnotPoint(x, m, t=0.0)  # for terminal knot point</code></pre><p>Use <code>is_terminal(z::KnotPoint)</code> to determine if a <code>KnotPoint</code> is a terminal knot point (e.g. has no time step length and z.t == tf).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/a247f7358f1e4b6bfd188253ef697e79eec14809/src/knotpoint.jl#L7-L38">source</a></section></article><h2 id="Traj-Type-1"><a class="docs-heading-anchor" href="#Traj-Type-1"><code>Traj</code> Type</a><a class="docs-heading-anchor-permalink" href="#Traj-Type-1" title="Permalink"></a></h2><p>The <code>Traj</code> type is simply a vector of <code>KnotPoint</code>s. However, it provides a few helpful methods for constructing and working vectors of <code>KnotPoint</code>s, which effectively describe a discrete-time state-control trajectory.</p><h3 id="Constructors-1"><a class="docs-heading-anchor" href="#Constructors-1">Constructors</a><a class="docs-heading-anchor-permalink" href="#Constructors-1" title="Permalink"></a></h3><p>Initialize a trajectory with <code>NaN</code> states and zeroed controls:</p><pre><code class="language-julia">Traj(n, m, dt, N)</code></pre><p>Copy a single state-control pair across <code>N</code> knot points:</p><pre><code class="language-julia">Traj(x::SVector, u::SVector, dt, N)</code></pre><p>Create a trajectory from individual state, control, and time step trajectories:</p><pre><code class="language-julia">Traj(X::Vector{&lt;:AbstractVector}, U::Vector{&lt;:AbstractVector}, dt::Vector)</code></pre><h3 id="Other-Methods-1"><a class="docs-heading-anchor" href="#Other-Methods-1">Other Methods</a><a class="docs-heading-anchor-permalink" href="#Other-Methods-1" title="Permalink"></a></h3><p>You can extract the state and control trajectories separately with the following methods:</p><pre><code class="language-julia">states(Z::Traj)
controls(Z::Traj)</code></pre><p>Note that these methods also work on <code>Problem</code> and <code>AbstractSolver</code> types.</p><p>The states, control, and time trajectories can be set independently with the following methods:</p><pre><code class="language-julia">set_states!(Z::Traj, X::Vector{&lt;:AbstractVector})
set_controls!(Z::Traj, U::Vector{&lt;:AbstractVector})
set_times!(Z::Traj, t::Vector)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="constraints.html">« 3. Creating Constraints</a><a class="docs-footer-nextpage" href="solving.html">5. Solving the Problem »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 2 January 2020 16:42">Thursday 2 January 2020</span>. Using Julia version 1.3.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
