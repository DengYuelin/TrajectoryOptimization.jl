<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Discretization · TrajectoryOptimization</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">TrajectoryOptimization</span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Introduction</a></li><li><span class="tocitem">Getting Started</span><ul><li><a class="tocitem" href="models.html">1. Setting up a Dynamics Model</a></li><li><a class="tocitem" href="costfunctions.html">2. Setting up an Objective</a></li><li><a class="tocitem" href="constraints.html">3. Creating Constraints</a></li><li><a class="tocitem" href="creating_problems.html">4. Setting up a Problem</a></li><li><a class="tocitem" href="solving.html">5. Solving the Problem</a></li></ul></li><li><span class="tocitem">Interfaces</span><ul><li><a class="tocitem" href="costfunction_interface.html">Cost Function Interface</a></li><li><a class="tocitem" href="constraint_interface.html">Constraint Interface</a></li><li><a class="tocitem" href="solver_interface.html">Solver Interface</a></li></ul></li><li><span class="tocitem">Documentation</span><ul><li><a class="tocitem" href="model_types.html">Model Types</a></li><li class="is-active"><a class="tocitem" href="discretization.html">Discretization</a><ul class="internal"><li><a class="tocitem" href="#Model-Discretization-1"><span>Model Discretization</span></a></li><li><a class="tocitem" href="#Integration-Schemes-1"><span>Integration Schemes</span></a></li><li><a class="tocitem" href="#Defining-a-New-Integration-Scheme-1"><span>Defining a New Integration Scheme</span></a></li></ul></li><li><a class="tocitem" href="cost_api.html">Cost Functions and Objectives</a></li><li><a class="tocitem" href="constraint_api.html">Constraints</a></li><li><a class="tocitem" href="problem.html">Problem</a></li><li><a class="tocitem" href="solvers.html">Solvers</a></li><li><a class="tocitem" href="rotations.html">Rotations</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Documentation</a></li><li class="is-active"><a href="discretization.html">Discretization</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="discretization.html">Discretization</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/master/docs/src/discretization.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Discretization-1"><a class="docs-heading-anchor" href="#Discretization-1">Discretization</a><a class="docs-heading-anchor-permalink" href="#Discretization-1" title="Permalink"></a></h1><p>This page gives details on the methods for evaluating discretized dynamics, as well as instructions on how to define a custom integration method.</p><h2 id="Model-Discretization-1"><a class="docs-heading-anchor" href="#Model-Discretization-1">Model Discretization</a><a class="docs-heading-anchor-permalink" href="#Model-Discretization-1" title="Permalink"></a></h2><p>With a model defined, we can compute the discrete dynamics and discrete dynamics Jacobians for an Implicit integration rule with the following methods</p><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.discrete_dynamics" href="#TrajectoryOptimization.discrete_dynamics"><code>TrajectoryOptimization.discrete_dynamics</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Compute the discretized dynamics of <code>model</code> using implicit integration scheme <code>Q&lt;:QuadratureRule</code>.</p><p>Methods:</p><pre><code class="language-none">x′ = discrete_dynamics(model, model, z)  # uses RK3 as the default integration scheme
x′ = discrete_dynamics(Q, model, x, u, t, dt)
x′ = discrete_dynamics(Q, model, z::KnotPoint)</code></pre><p>The default integration scheme is stored in <code>TrajectoryOptimization.DEFAULT_Q</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/b3bef43b5c338815bc22dd006c43ffdb33288749/src/static_model.jl#L140-L151">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.discrete_jacobian" href="#TrajectoryOptimization.discrete_jacobian"><code>TrajectoryOptimization.discrete_jacobian</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Compute the discrete dynamics Jacobian of <code>model</code> using implicit integration scheme <code>Q&lt;:QuadratureRule</code></p><p>Methods:</p><pre><code class="language-none">∇f = discrete_dynamics(model, z::KnotPoint)  # uses RK3 as the default integration scheme
∇f = discrete_jacobian(Q, model, z::KnotPoint)
∇f = discrete_jacobian(Q, model, s::SVector{NM1}, t, ix::SVector{N}, iu::SVector{M})</code></pre><p>where <code>s = [x; u; dt]</code>, <code>t</code> is the time, and <code>ix</code> and <code>iu</code> are the indices to extract the state and controls.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/b3bef43b5c338815bc22dd006c43ffdb33288749/src/static_model.jl#L154-L164">source</a></section></article><h2 id="Integration-Schemes-1"><a class="docs-heading-anchor" href="#Integration-Schemes-1">Integration Schemes</a><a class="docs-heading-anchor-permalink" href="#Integration-Schemes-1" title="Permalink"></a></h2><p>TrajectoryOptimization.jl has already defined a handful of integration schemes for computing discrete dynamics. The integration schemes are specified as abstract types, so that methods can efficiently dispatch based on the integration scheme selected. Here is the current set of implemented types:</p><ul><li><a href="discretization.html#TrajectoryOptimization.QuadratureRule"><code>QuadratureRule</code></a><ul><li><a href="discretization.html#TrajectoryOptimization.Implicit"><code>Implicit</code></a><ul><li><a href="discretization.html#TrajectoryOptimization.RK3"><code>RK3</code></a></li></ul></li><li><a href="discretization.html#TrajectoryOptimization.Explicit"><code>Explicit</code></a><ul><li><a href="discretization.html#TrajectoryOptimization.HermiteSimpson"><code>HermiteSimpson</code></a></li></ul></li></ul></li></ul><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.QuadratureRule" href="#TrajectoryOptimization.QuadratureRule"><code>TrajectoryOptimization.QuadratureRule</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Integration rule for approximating the continuous integrals for the equations of motion</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/b3bef43b5c338815bc22dd006c43ffdb33288749/src/static_model.jl#L55">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.Implicit" href="#TrajectoryOptimization.Implicit"><code>TrajectoryOptimization.Implicit</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Integration rules of the form x′ = f(x,u), where x′ is the next state</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/b3bef43b5c338815bc22dd006c43ffdb33288749/src/static_model.jl#L57">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.RK3" href="#TrajectoryOptimization.RK3"><code>TrajectoryOptimization.RK3</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Third-order Runge-Kutta method with zero-order-old on the controls</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/b3bef43b5c338815bc22dd006c43ffdb33288749/src/static_model.jl#L61">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.Explicit" href="#TrajectoryOptimization.Explicit"><code>TrajectoryOptimization.Explicit</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Integration rules of the form x′ = f(x,u,x′,u′), where x′,u′ are the states and controls at the next time step.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/b3bef43b5c338815bc22dd006c43ffdb33288749/src/static_model.jl#L59">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.HermiteSimpson" href="#TrajectoryOptimization.HermiteSimpson"><code>TrajectoryOptimization.HermiteSimpson</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Third-order Runge-Kutta method with first-order-hold on the controls</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/b3bef43b5c338815bc22dd006c43ffdb33288749/src/static_model.jl#L63">source</a></section></article><h2 id="Defining-a-New-Integration-Scheme-1"><a class="docs-heading-anchor" href="#Defining-a-New-Integration-Scheme-1">Defining a New Integration Scheme</a><a class="docs-heading-anchor-permalink" href="#Defining-a-New-Integration-Scheme-1" title="Permalink"></a></h2><h3 id="Implicit-Methods-1"><a class="docs-heading-anchor" href="#Implicit-Methods-1">Implicit Methods</a><a class="docs-heading-anchor-permalink" href="#Implicit-Methods-1" title="Permalink"></a></h3><p>Implicit integration schemes are understandably simpler, since the output is not a function of itself, as is the case with explicit jschemes. As such, as a minimum, the user only needs to define the following method for a new rule <code>MyQ</code>:</p><pre><code class="language-julia">x′ = discrete_dynamics(::Type{MyQ}, model::AbstractModel, x, u, dt)</code></pre><h3 id="Explicit-Methods-1"><a class="docs-heading-anchor" href="#Explicit-Methods-1">Explicit Methods</a><a class="docs-heading-anchor-permalink" href="#Explicit-Methods-1" title="Permalink"></a></h3><p>Explicit integration schemes are specified with a <a href="constraint_api.html#TrajectoryOptimization.DynamicsConstraint"><code>DynamicsConstraint</code></a>. These methods are most efficiently computed when the entire trajectory is considered at once, thereby avoiding duplicate function evaluations. As a result, the user must define methods that deal with the entire trajectory at once:</p><pre><code class="language-julia">evaluate!(vals::Vector{&lt;:AbstractVector}, con::DynamicsConstraint{MyQ},
    Z::Traj, inds=1:length(Z)-1)</code></pre><p>Here <code>vals</code> is a Vector of Static Vectors, where the result of the calculation will be stored. <code>con</code> is a <code>DynamicsConstraint</code> that specifies the integration scheme, <code>Z</code> is the trajectory, and <code>inds</code> are the knotpoints where the constraint is applied (which should always be 1:N-1 if you have a single model for the entire trajectory). The method should compute</p><pre><code class="language-julia">vals[k] = x[k+1] - f(x[k],u[k],x[k+1],u[k+1])</code></pre><p>which is the amount of dynamic infeasibility between knotpoints. The method should obviously loop over the entire trajectory (see implementation for <code>HermiteSimpson</code>).</p><h3 id="Integrating-Cost-Functions-1"><a class="docs-heading-anchor" href="#Integrating-Cost-Functions-1">Integrating Cost Functions</a><a class="docs-heading-anchor-permalink" href="#Integrating-Cost-Functions-1" title="Permalink"></a></h3><p>Some methods, such as DIRCOL, apply the integration scheme to the cost function, as well. This can be done for a new integration rule by defining the following methods:</p><pre><code class="language-julia">cost(obj::Objective, dyn_con::DynamicsConstraint{MyQ}, Z::Traj)
cost_gradient!(E::CostExpansion, obj::Objective, dyn_con::DynamicsConstraint{MyQ}, Z::Traj)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="model_types.html">« Model Types</a><a class="docs-footer-nextpage" href="cost_api.html">Cost Functions and Objectives »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 7 January 2020 23:27">Tuesday 7 January 2020</span>. Using Julia version 1.3.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
