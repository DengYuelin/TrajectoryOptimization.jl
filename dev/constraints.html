<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>3. Creating Constraints · TrajectoryOptimization</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">TrajectoryOptimization</span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Introduction</a></li><li><a class="tocitem" href="models.html">1. Setting up a Dynamics Model</a></li><li><a class="tocitem" href="costfunctions.html">2. Setting up an Objective</a></li><li class="is-active"><a class="tocitem" href="constraints.html">3. Creating Constraints</a><ul class="internal"><li><a class="tocitem" href="#Creating-Constraint-Sets-1"><span>Creating Constraint Sets</span></a></li><li><a class="tocitem" href="#Defined-Constraints-1"><span>Defined Constraints</span></a></li><li><a class="tocitem" href="#Constraint-Type-1"><span>Constraint Type</span></a></li><li><a class="tocitem" href="#Adding-a-New-Constraint-1"><span>Adding a New Constraint</span></a></li><li><a class="tocitem" href="#API-1"><span>API</span></a></li></ul></li><li><a class="tocitem" href="problem.html">4. Setting up a Problem</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="constraints.html">3. Creating Constraints</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="constraints.html">3. Creating Constraints</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/master/docs/src/constraints.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="constraint_section-1"><a class="docs-heading-anchor" href="#constraint_section-1">3. Creating Constraints</a><a class="docs-heading-anchor-permalink" href="#constraint_section-1" title="Permalink"></a></h1><ul><li><a href="constraints.html#constraint_section-1">3. Creating Constraints</a></li><ul><li><a href="constraints.html#Creating-Constraint-Sets-1">Creating Constraint Sets</a></li><li><a href="constraints.html#Defined-Constraints-1">Defined Constraints</a></li><li><a href="constraints.html#Constraint-Type-1">Constraint Type</a></li><li><a href="constraints.html#Adding-a-New-Constraint-1">Adding a New Constraint</a></li><li><a href="constraints.html#API-1">API</a></li></ul></ul><h2 id="Creating-Constraint-Sets-1"><a class="docs-heading-anchor" href="#Creating-Constraint-Sets-1">Creating Constraint Sets</a><a class="docs-heading-anchor-permalink" href="#Creating-Constraint-Sets-1" title="Permalink"></a></h2><p>The easiest way to set up the constraints for your problem is through the <a href="@ref"><code>ConstraintSet</code></a>. This structure simply holds a vector of all the constraints in the trajectory optimization problem. The easiest way to start is to create an empty <code>ConstraintSet</code>:</p><pre><code class="language-julia">conSet = ConstraintSet(n,m,N)</code></pre><h3 id="Adding-Constraints-1"><a class="docs-heading-anchor" href="#Adding-Constraints-1">Adding Constraints</a><a class="docs-heading-anchor-permalink" href="#Adding-Constraints-1" title="Permalink"></a></h3><p>You can add any constraint (the list of currently implemented constraints is given in the following section) to the constraint set using the following method:</p><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.add_constraint!" href="#TrajectoryOptimization.add_constraint!"><code>TrajectoryOptimization.add_constraint!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">add_constraint!(conSet, conVal::ConstraintVals, idx=-1)
add_constraint!(conSet, con::AbstractConstraint, inds::UnitRange, idx=-1)</code></pre><p>Add a constraint to the constraint set. You can directly add a <code>ConstraintVals</code> type, but when adding a normal <code>AbstractConstraint</code> you must specify the range of knotpoints to which the constraint applies.</p><p>The optional <code>idx</code> argument allows you to specify exactly where in the vector of constraints you&#39;d like the constraint to be added. The ordering will effect the order in which the constraint appears in concatenated vectors of constraint values (that show up in direct methods), potentially effecting the band structure of the resultant Jacobian. See solvers for more details.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/constraint_sets.jl#L77-L90">source</a></section></article><h3 id="Other-Methods-1"><a class="docs-heading-anchor" href="#Other-Methods-1">Other Methods</a><a class="docs-heading-anchor-permalink" href="#Other-Methods-1" title="Permalink"></a></h3><p>There are a variety of methods defined on constraint sets, since they are the general interface that solvers work with when dealing with constraints.</p><h4 id="Information-Methods-1"><a class="docs-heading-anchor" href="#Information-Methods-1">Information Methods</a><a class="docs-heading-anchor-permalink" href="#Information-Methods-1" title="Permalink"></a></h4><p>These methods provide or calculate information about the constraint set</p><article class="docstring"><header><a class="docstring-binding" id="Base.size-Tuple{ConstraintSet}" href="#Base.size-Tuple{ConstraintSet}"><code>Base.size</code></a> — <span class="docstring-category">Method</span></header><section><div><p>Get size of state and control dimensions</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/constraint_sets.jl#L49">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Base.length-Tuple{ConstraintSet}" href="#Base.length-Tuple{ConstraintSet}"><code>Base.length</code></a> — <span class="docstring-category">Method</span></header><section><div><p>Get number of separate constraints (i.e. ConstraintVals) in the set</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/constraint_sets.jl#L51">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.num_constraints!" href="#TrajectoryOptimization.num_constraints!"><code>TrajectoryOptimization.num_constraints!</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Re-calculate the number of constraints in the constraint set</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/constraint_sets.jl#L57">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.num_constraints" href="#TrajectoryOptimization.num_constraints"><code>TrajectoryOptimization.num_constraints</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">num_constraints(::ConstraintSet)
num_constraints(::AbstractSolver)
num_constraints(::Problem)</code></pre><p>Get the total number of constraints at each time step</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/constraint_sets.jl#L68-L75">source</a></section></article><h4 id="Calculation-Methods-1"><a class="docs-heading-anchor" href="#Calculation-Methods-1">Calculation Methods</a><a class="docs-heading-anchor-permalink" href="#Calculation-Methods-1" title="Permalink"></a></h4><p>These methods perform calculations on the constraint set</p><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.max_violation" href="#TrajectoryOptimization.max_violation"><code>TrajectoryOptimization.max_violation</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">max_violation(conSet::ConstraintSet)
max_violation(conSet::ConstraintSet, Z::Traj)
max_violation(prob::Problem, Z=prob.Z)
max_violation(solver::AbstractSolver)
max_violation(solver::AbstractSolver, Z)</code></pre><p>Calculate the maximum constraint violation for the entire constraint set. 	If the a trajectory is not passed in, the violation is computed from the currently 	stored constraint values; otherwise, the constraints are re-computed using the 	trajectory passed in.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/constraint_sets.jl#L108-L120">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.max_penalty" href="#TrajectoryOptimization.max_penalty"><code>TrajectoryOptimization.max_penalty</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Calculate the maximum penalty parameter across all constraints</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/constraint_sets.jl#L138">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.evaluate!-Tuple{ConstraintSet,AbstractArray{#s29,1} where #s29&lt;:KnotPoint}" href="#TrajectoryOptimization.evaluate!-Tuple{ConstraintSet,AbstractArray{#s29,1} where #s29&lt;:KnotPoint}"><code>TrajectoryOptimization.evaluate!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">evaluate!(conSet::ConstraintSet, Z::Traj)</code></pre><p>Compute constraint values for all constraints for the entire trajectory</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/constraint_sets.jl#L152-L157">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.jacobian!-Tuple{ConstraintSet,AbstractArray{#s29,1} where #s29&lt;:KnotPoint}" href="#TrajectoryOptimization.jacobian!-Tuple{ConstraintSet,AbstractArray{#s29,1} where #s29&lt;:KnotPoint}"><code>TrajectoryOptimization.jacobian!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">jacobian!(conSet::ConstraintSet, Z::Traj)</code></pre><p>Compute constraint Jacobians for all constraints for the entire trajectory</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/constraint_sets.jl#L163-L168">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.reset!-Tuple{ConstraintSet}" href="#TrajectoryOptimization.reset!-Tuple{ConstraintSet}"><code>TrajectoryOptimization.reset!</code></a> — <span class="docstring-category">Method</span></header><section><div><p>Reset all the Lagrange multipliers and constraint values to zero and 	penalties the their initial value</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/constraint_sets.jl#L190-L192">source</a></section></article><p><code>ConstraintSet</code> supports indexing and iteration, which returns the <code>ConstraintVals</code> at that index. However, to avoid allocations, iteration directly on the <code>.constraints</code> field.</p><p>Additionally, to avoid allocations when computing <code>max_violation</code>, you can call <code>max_violation!(conSet)</code> and then <code>maximum(conSet.c_max)</code> to perform the reduction in the scope where the result is stored (thereby avoiding an allocation).</p><h2 id="Defined-Constraints-1"><a class="docs-heading-anchor" href="#Defined-Constraints-1">Defined Constraints</a><a class="docs-heading-anchor-permalink" href="#Defined-Constraints-1" title="Permalink"></a></h2><p>The following constraints are currently defined. See later sections on the constraint interface and how to add custom constraints.</p><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.GoalConstraint" href="#TrajectoryOptimization.GoalConstraint"><code>TrajectoryOptimization.GoalConstraint</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">struct GoalConstraint{T, P, N, L} &lt;: TrajectoryOptimization.AbstractConstraint{Equality,State,P}</code></pre><p>Constraint of the form <span>$x_g = a$</span>, where <span>$x_g$</span> can be only part of the state vector.</p><p><strong>Constructors:</strong></p><pre><code class="language-julia">GoalConstraint(xf::AbstractVector)
GoalConstraint(xf::AbstractVector, inds)</code></pre><p>where <code>xf</code> is an n-dimensional goal state. If <code>inds</code> is provided, only <code>xf[inds]</code> will be used.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/static_constraints.jl#L15">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.BoundConstraint" href="#TrajectoryOptimization.BoundConstraint"><code>TrajectoryOptimization.BoundConstraint</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">struct BoundConstraint{T, P, PN, NM, PNM} &lt;: TrajectoryOptimization.AbstractConstraint{Inequality,Stage,P}</code></pre><p>Linear bound constraint on states and controls</p><p><strong>Constructors</strong></p><pre><code class="language-julia">BoundConstraint(n, m; x_min, x_max, u_min, u_max)</code></pre><p>Any of the bounds can be ±∞. The bound can also be specifed as a single scalar, which applies the bound to all state/controls.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/static_constraints.jl#L199">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.CircleConstraint" href="#TrajectoryOptimization.CircleConstraint"><code>TrajectoryOptimization.CircleConstraint</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">struct CircleConstraint{T, P} &lt;: TrajectoryOptimization.AbstractConstraint{Inequality,State,P}</code></pre><p>Constraint of the form <span>$(x - x_c)^2 + (y - y_c)^2 \leq r^2$</span> where <span>$x$</span>, <span>$y$</span> are given by <code>x[xi]</code>,<code>x[yi]</code>, <span>$(x_c,y_c)$</span> is the center of the circle, and <span>$r$</span> is the radius.</p><p><strong>Constructor: ```julia</strong></p><p>CircleConstraint(n, xc::SVector{P}, yc::SVector{P}, radius::SVector{P}, xi=1, yi=2) ```</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/static_constraints.jl#L97">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.SphereConstraint" href="#TrajectoryOptimization.SphereConstraint"><code>TrajectoryOptimization.SphereConstraint</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">struct SphereConstraint{T, P} &lt;: TrajectoryOptimization.AbstractConstraint{Inequality,State,P}</code></pre><p>Constraint of the form <span>$(x - x_c)^2 + (y - y_c)^2 + (z - z_c)^2 \leq r^2$</span> where <span>$x$</span>, <span>$y$</span>, <span>$z$</span> are given by <code>x[xi]</code>,<code>x[yi]</code>,<code>x[zi]</code>, <span>$(x_c,y_c,z_c)$</span> is the center of the sphere, and <span>$r$</span> is the radius.</p><p><strong>Constructor:</strong></p><pre><code class="language-none">SphereConstraint(n, xc::SVector{P}, yc::SVector{P}, zc::SVector{P},
	radius::SVector{P}, xi=1, yi=2, zi=3)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/static_constraints.jl#L129">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.NormConstraint" href="#TrajectoryOptimization.NormConstraint"><code>TrajectoryOptimization.NormConstraint</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">struct NormConstraint{S, W&lt;:Union{Control, State}, T} &lt;: TrajectoryOptimization.AbstractConstraint{S,W&lt;:Union{Control, State},1}</code></pre><p>Constraint of the form <span>$\norm(y)^2 \leq val$</span> where <span>$y$</span> is either a state or a vector (but not both)</p><p><strong>Constructors:</strong></p><pre><code class="language-none">NormConstraint{S,State}(n,val)
NormConstraint{S,Control}(m,val)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/static_constraints.jl#L171">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.IndexedConstraint" href="#TrajectoryOptimization.IndexedConstraint"><code>TrajectoryOptimization.IndexedConstraint</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">struct IndexedConstraint{S, W, P, N, M, NM, Bx, Bu, C} &lt;: TrajectoryOptimization.AbstractConstraint{S,W,P}</code></pre><p>Compute a constraint on an arbitrary portion of either the state or control, or both. Useful for dynamics augmentation. e.g. you are controlling two models, and have individual constraints on each. You can define constraints as if they applied to the individual model, and then wrap it in an <code>IndexedConstraint</code> to apply it to the appropriate portion of the concatenated state. Assumes the indexed state portion is contiguous.</p><p>Type params:</p><ul><li>S - Inequality or Equality</li><li>W - ConstraintType</li><li>P - Constraint length</li><li>N,M - original state and control dimensions</li><li>NM - N+M</li><li>Bx - location of the first element in the state index</li><li>Bu - location of the first element in the control index</li><li>C - type of original constraint</li></ul><p>Constructors:<code>julia IndexedConstraint(n, m, con) IndexedConstraint(n, m, con, ix::SVector, iu::SVector)</code> where the arguments <code>n</code> and <code>m</code> are the state and control dimensions of the new dynamics. <code>ix</code> and <code>iu</code> are the indices into the state and control vectors. If left out, they are assumed to start at the beginning of the vector.</p><p>NOTE: Only part of this functionality has been tested. Use with caution!</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/static_constraints.jl#L380-L406">source</a></section></article><h2 id="Constraint-Type-1"><a class="docs-heading-anchor" href="#Constraint-Type-1">Constraint Type</a><a class="docs-heading-anchor-permalink" href="#Constraint-Type-1" title="Permalink"></a></h2><p>All constraints inherit from <code>AbstractConstraint{S&lt;:ConstraintSense,W&lt;:ConstraintType,P}</code>, where <code>ConstraintSense</code> specifies <code>Inequality</code> or <code>Equality</code>, <code>ConstraintType</code> specifies the &quot;bandedness&quot; of the constraint (will be discussed more later), and <code>P</code> is the dimension of the constraint. This allows the software to easily dispatch over the type of constraint. Each constraint type represents a vector-valued constraint. The intention is that each constraint type represent one line in the constraints of problem definition (where they may be vector or scalar-valued).</p><p>TrajectoryOptimization.jl assumes equality constraints are of the form <span>$g(x) = 0$</span> and inequality constraints are of the form <span>$h(x) \leq 0$</span>.</p><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.AbstractConstraint" href="#TrajectoryOptimization.AbstractConstraint"><code>TrajectoryOptimization.AbstractConstraint</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">abstract type AbstractConstraint &lt;: TrajectoryOptimization.GeneralConstraint</code></pre><p>Abstract vector-valued constraint of size <code>P</code> for a trajectory optimization problem. May be either inequality or equality (specified by <code>S&lt;:ConstraintSense</code>), and be function of single, adjacent, or all knotpoints (specified by <code>W&lt;:ConstraintType</code>).</p><p>Interface: Any constraint type must implement the following interface:</p><pre><code class="language-julia">n = state_dim(::MyCon)
m = control_dim(::MyCon)
p = Base.length(::MyCon)
c = evaluate(::MyCon, args...)   # args determined by W
∇c = jacobian(::MyCon, args...)  # args determined by W</code></pre><p>The <code>evaluate</code> and <code>jacobian</code> (identical signatures) methods should have the following signatures</p><ul><li>W &lt;: State: <code>evaluate(::MyCon, x::SVector)</code></li><li>W &lt;: Control: <code>evaluate(::MyCon, u::SVector)</code></li><li>W &lt;: Stage: <code>evaluate(::MyCon, x, u)</code></li><li>W &lt;: Dynamical: <code>evaluate(::MyCon, x′, x, u)</code></li><li>W &lt;: Coupled: <code>evaluate(::MyCon, x′, u′ x, u)</code></li></ul><p>Or alternatively,</p><ul><li>W &lt;: Stage: <code>evaluate(::MyCon, z::KnotPoint)</code></li><li>W &lt;: Coupled: <code>evaluate(::MyCon, z′::KnotPoint, z::KnotPoint)</code></li></ul><p>The Jacobian method for <a href="constraints.html#TrajectoryOptimization.State"><code>State</code></a> or <a href="constraints.html#TrajectoryOptimization.Control"><code>Control</code></a> is optional, since it will 	be automatically computed using ForwardDiff. Automatic differentiation 	for other types of constraints is not yet supported.</p><p>For W &lt;: State, <code>control_dim(::MyCon)</code> doesn&#39;t need to be defined. Equivalently, for 	W &lt;: Control, <code>state_dim(::MyCon)</code> doesn&#39;t need to be defined.</p><p>For W &lt;: General, the more general <code>evaluate</code> and <code>jacobian</code> methods must be used</p><pre><code class="language-julia">evaluate!(vals::Vector{&lt;:AbstractVector}, ::MyCon, Z::Traj, inds=1:length(Z)-1)
jacobian!(∇c::Vector{&lt;:AbstractMatrix}, ::MyCon, Z::Traj, inds=1:length(Z)-1)</code></pre><p>These methods can be specified for any constraint, instead of the not-in-place functions 	above.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L68-L109">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.ConstraintSense" href="#TrajectoryOptimization.ConstraintSense"><code>TrajectoryOptimization.ConstraintSense</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Specifies whether the constraint is an equality or inequality constraint. Valid subtypes are <code>Equality</code>, <code>Inequality</code>, and <code>Null</code></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L18-L20">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.ConstraintType" href="#TrajectoryOptimization.ConstraintType"><code>TrajectoryOptimization.ConstraintType</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Specifies the ``bandedness&#39;&#39; of the constraint. This ends up being the width of the constraint Jacobian, or the total number of input variables. This is important to reduce the size of arrays needed to store the Jacobian, as well as special-case the block matrix algebra.</p><p>Current subtypes:</p><ul><li><a href="constraints.html#TrajectoryOptimization.Stage"><code>Stage</code></a></li><li><a href="constraints.html#TrajectoryOptimization.State"><code>State</code></a> &lt;: <code>Stage</code></li><li><a href="constraints.html#TrajectoryOptimization.Control"><code>Control</code></a> &lt;: <code>Stage</code></li><li><a href="constraints.html#TrajectoryOptimization.Coupled"><code>Coupled</code></a></li><li><a href="constraints.html#TrajectoryOptimization.Dynamical"><code>Dynamical</code></a> &lt;: <code>Coupled</code></li><li><a href="constraints.html#TrajectoryOptimization.CoupledState"><code>CoupledState</code></a> &lt;: <code>Coupled</code></li><li><a href="constraints.html#TrajectoryOptimization.CoupledControl"><code>CoupledControl</code></a> &lt;: <code>Coupled</code></li><li><a href="constraints.html#TrajectoryOptimization.General"><code>General</code></a></li><li><a href="constraints.html#TrajectoryOptimization.GeneralState"><code>GeneralState</code></a> &lt;: <code>General</code></li><li><a href="constraints.html#TrajectoryOptimization.GeneralControl"><code>GeneralControl</code></a> &lt;: <code>General</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L27-L44">source</a></section></article><h3 id="Methods-1"><a class="docs-heading-anchor" href="#Methods-1">Methods</a><a class="docs-heading-anchor-permalink" href="#Methods-1" title="Permalink"></a></h3><p>The following methods are defined for all <code>AbstractConstraint</code>s</p><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.state_dims" href="#TrajectoryOptimization.state_dims"><code>TrajectoryOptimization.state_dims</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Size of control vector</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L152">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.control_dims" href="#TrajectoryOptimization.control_dims"><code>TrajectoryOptimization.control_dims</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Size of state vector</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L148">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.evaluate!" href="#TrajectoryOptimization.evaluate!"><code>TrajectoryOptimization.evaluate!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">evaluate!(vals::Vector{&lt;:AbstractVector}, con::AbstractConstraint{S,W,P},
	Z, inds=1:length(Z)-1)</code></pre><p>Evaluate constraints for entire trajectory. This is the most general method used to evaluate 	constraints, and should be the one used in other functions.</p><p>For W&lt;:Stage this will loop over calls to <code>evaluate(con,Z[k])</code></p><p>For W&lt;:Coupled this will loop over calls to <code>evaluate(con,Z[k+1],Z[k])</code></p><p>For W&lt;:General,this must function must be explicitly defined. Other types may define it 	if desired.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L162-L176">source</a></section><section><div><pre><code class="language-julia">evaluate!(conSet::ConstraintSet, Z::Traj)</code></pre><p>Compute constraint values for all constraints for the entire trajectory</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/constraint_sets.jl#L152-L157">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.jacobian!" href="#TrajectoryOptimization.jacobian!"><code>TrajectoryOptimization.jacobian!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">jacobian!(vals::Vector{&lt;:AbstractVector}, con::AbstractConstraint{S,W,P},
	Z, inds=1:length(Z)-1)</code></pre><p>Evaluate constraint Jacobians for entire trajectory. This is the most general method used to 	evaluate constraint Jacobians, and should be the one used in other functions.</p><p>For W&lt;:Stage this will loop over calls to <code>jacobian(con,Z[k])</code></p><p>For W&lt;:Coupled this will loop over calls to <code>jacobian(con,Z[k+1],Z[k])</code></p><p>For W&lt;:General,this must function must be explicitly defined. Other types may define it 	if desired.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L190-L204">source</a></section><section><div><pre><code class="language-julia">jacobian!(conSet::ConstraintSet, Z::Traj)</code></pre><p>Compute constraint Jacobians for all constraints for the entire trajectory</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/constraint_sets.jl#L163-L168">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.contype" href="#TrajectoryOptimization.contype"><code>TrajectoryOptimization.contype</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Get type of constraint (bandedness)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L112">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.sense" href="#TrajectoryOptimization.sense"><code>TrajectoryOptimization.sense</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Get constraint sense (Inequality vs Equality)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L114">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.width" href="#TrajectoryOptimization.width"><code>TrajectoryOptimization.width</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Returns the width of the constraint Jacobian, i.e. the total number of inputs to the constraint</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L117-L119">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.upper_bound" href="#TrajectoryOptimization.upper_bound"><code>TrajectoryOptimization.upper_bound</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Upper bound of the constraint, as a vector, which is 0 for all constraints (except bound constraints)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L128-L130">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.lower_bound" href="#TrajectoryOptimization.lower_bound"><code>TrajectoryOptimization.lower_bound</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Upper bound of the constraint, as a vector, which is 0 equality and -Inf for inequality (except bound constraints)</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L133-L135">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.is_bound" href="#TrajectoryOptimization.is_bound"><code>TrajectoryOptimization.is_bound</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Is the constraint a bound constraint or not</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L138">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.check_dims" href="#TrajectoryOptimization.check_dims"><code>TrajectoryOptimization.check_dims</code></a> — <span class="docstring-category">Function</span></header><section><div><p>Check whether the constraint is consistent with the specified state and control dimensions</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L141">source</a></section></article><h2 id="Adding-a-New-Constraint-1"><a class="docs-heading-anchor" href="#Adding-a-New-Constraint-1">Adding a New Constraint</a><a class="docs-heading-anchor-permalink" href="#Adding-a-New-Constraint-1" title="Permalink"></a></h2><p>See interface description in documentation for <a href="constraints.html#TrajectoryOptimization.AbstractConstraint"><code>AbstractConstraint</code></a>. The interface allows for a lot of flexibility, but let&#39;s do a simple example. Let&#39;s say we have a 2-norm constraint on the controls at each time step, e.g. <span>$||u|| \leq a$</span>. We can do this with just a few lines of code:</p><pre><code class="language-julia">struct ControlNorm{T} &lt;: AbstractConstraint{Inequality,Control,1}
  m::Int
  a::T
end
control_dim(con::ControlNorm) = con.m
evaluate(con::ControlNorm, u::SVector) = @SVector [norm(u) - con.a] # needs to be a vector output
jacobian(con::ControlNorm, u::SVector) = u&#39;/norm(u)  # optional</code></pre><p>Importantly, note that the inheritance specifies the constraint applies only to individual controls, the constraint in an inequality, and has dimension 1.</p><p>Let&#39;s say the bound <span>$a$</span> varied by time-step. We could handle this easily by instead defining the methods operating on the entire trajectory:</p><pre><code class="language-julia">struct ControlNorm2{T} &lt;: AbstractConstraint{Inequality,Control,1}
  m::Int
  a::Vector{T}
end
control_dim(con::ControlNorm) = con.m
function evaluate!(vals::Vector{&lt;:AbstractVector}, con::ControlNorm,
    Z, inds=1:length(Z)-1)
  for (i,k) in enumerate(inds)
    u = control(Z[k])
    vals[i] = @SVector [norm(u) - con.a[k]]
  end
end
function jacobian!(∇c::Vector{&lt;:AbstractMatrix}, con::ControlNorm,
    Z, inds=1:length(Z)-1)
  for (i,k) in enumerate(inds)
    u = control(Z[k])
    ∇c[i] = u&#39;/norm(u)
  end
end</code></pre><h2 id="API-1"><a class="docs-heading-anchor" href="#API-1">API</a><a class="docs-heading-anchor-permalink" href="#API-1" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.ConstraintVals" href="#TrajectoryOptimization.ConstraintVals"><code>TrajectoryOptimization.ConstraintVals</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">struct ConstraintVals{T, W, C, P, NM, PNM}</code></pre><p>Struct that stores all of the values associated with a particular constraint. Importantly, <code>ConstraintVals</code> stores the list of knotpoints to which the constraint is applied. This type should be fairly transparent to the user, and only needs to be directly dealt with when writing solvers or setting fine-tuned updates per constraint (via the <code>.params</code> field).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/constraint_vals.jl#L11-L18">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.Stage" href="#TrajectoryOptimization.Stage"><code>TrajectoryOptimization.Stage</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Only a function of states and controls at a single knotpoint</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L46">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.State" href="#TrajectoryOptimization.State"><code>TrajectoryOptimization.State</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Only a function of states at a single knotpoint</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L48">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.Control" href="#TrajectoryOptimization.Control"><code>TrajectoryOptimization.Control</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Only a function of controls at a single knotpoint</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L50">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.Coupled" href="#TrajectoryOptimization.Coupled"><code>TrajectoryOptimization.Coupled</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Only a function of states and controls at two adjacent knotpoints</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L52">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.Dynamical" href="#TrajectoryOptimization.Dynamical"><code>TrajectoryOptimization.Dynamical</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Only a function of states and two adjacent knotpoints, and the control at the previous knotpoint, i.e. f(x,u) - x′</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L54-L56">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.CoupledState" href="#TrajectoryOptimization.CoupledState"><code>TrajectoryOptimization.CoupledState</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Only a function of states at adjacent knotpoints</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L57">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.CoupledControl" href="#TrajectoryOptimization.CoupledControl"><code>TrajectoryOptimization.CoupledControl</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Only a function of controls at adjacent knotpoints</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L59">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.General" href="#TrajectoryOptimization.General"><code>TrajectoryOptimization.General</code></a> — <span class="docstring-category">Type</span></header><section><div><p>A function of all states and controls in the trajectory</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L61">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.GeneralState" href="#TrajectoryOptimization.GeneralState"><code>TrajectoryOptimization.GeneralState</code></a> — <span class="docstring-category">Type</span></header><section><div><p>A function of all states in the trajectory</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L63">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TrajectoryOptimization.GeneralControl" href="#TrajectoryOptimization.GeneralControl"><code>TrajectoryOptimization.GeneralControl</code></a> — <span class="docstring-category">Type</span></header><section><div><p>A function of all controls in the trajectory</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/466b23960c72df7d9857d0b47c2640f5da57550e/src/abstract_constraint.jl#L65">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="costfunctions.html">« 2. Setting up an Objective</a><a class="docs-footer-nextpage" href="problem.html">4. Setting up a Problem »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 24 December 2019 11:08">Tuesday 24 December 2019</span>. Using Julia version 1.2.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
