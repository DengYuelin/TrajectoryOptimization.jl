<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Setting up a Dynamics Model · TrajectoryOptimization</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>TrajectoryOptimization</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">TrajectoryOptimization.jl</a></li><li class="current"><a class="toctext" href>Setting up a Dynamics Model</a><ul class="internal"><li class="toplevel"><a class="toctext" href="#Overview-1">Overview</a></li><li class="toplevel"><a class="toctext" href="#Continuous-Models-1">Continuous Models</a></li><li><a class="toctext" href="#Analytical-Models-1">Analytical Models</a></li><li><a class="toctext" href="#URDF-Models-1">URDF Models</a></li><li class="toplevel"><a class="toctext" href="#Discrete-Models-1">Discrete Models</a></li><li><a class="toctext" href="#Analytical-1">Analytical</a></li><li><a class="toctext" href="#From-Continuous-Model-1">From Continuous Model</a></li><li class="toplevel"><a class="toctext" href="#API-1">API</a></li></ul></li><li><a class="toctext" href="../constraints/">Constraints</a></li><li><a class="toctext" href="../problem/">Setting up a Problem</a></li><li><a class="toctext" href="../solvers/">Solvers</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Setting up a Dynamics Model</a></li></ul><a class="edit-page" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/master/docs/src/models.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Setting up a Dynamics Model</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Setting-up-a-Dynamics-Model-1" href="#Setting-up-a-Dynamics-Model-1">Setting up a Dynamics Model</a></h1><ul><li><a href="../constraints/#Constraints-1">Constraints</a></li><li><a href="../constraints/#Constraint-Type-1">Constraint Type</a></li><li><a href="../constraints/#Creating-Constraints-1">Creating Constraints</a></li><ul><li><a href="../constraints/#Special-Constraints-1">Special Constraints</a></li></ul><li><a href="#Setting-up-a-Dynamics-Model-1">Setting up a Dynamics Model</a></li><li><a href="#Overview-1">Overview</a></li><li><a href="#Continuous-Models-1">Continuous Models</a></li><ul><li><a href="#Analytical-Models-1">Analytical Models</a></li><li><a href="#URDF-Models-1">URDF Models</a></li></ul><li><a href="#Discrete-Models-1">Discrete Models</a></li><ul><li><a href="#Analytical-1">Analytical</a></li><li><a href="#From-Continuous-Model-1">From Continuous Model</a></li></ul><li><a href="#API-1">API</a></li><li><a href="../solvers/#Solvers-1">Solvers</a></li><li><a href="../solvers/#Iterative-LQR-(iLQR)-1">Iterative LQR (iLQR)</a></li><li><a href="../problem/#Setting-up-a-Problem-1">Setting up a Problem</a></li><ul><li><a href="../problem/#Creating-a-Problem-1">Creating a Problem</a></li><li><a href="../problem/#Adding-constraints-1">Adding constraints</a></li></ul><li><a href="../#TrajectoryOptimization.jl-1">TrajectoryOptimization.jl</a></li><li><a href="../#Overview-1">Overview</a></li><li><a href="../#Getting-Started-1">Getting Started</a></li><ul><li><a href="../#Creating-a-Model-1">Creating a Model</a></li><li><a href="../#Creating-an-Objective-1">Creating an Objective</a></li><li><a href="../#Solving-the-Problem-1">Solving the Problem</a></li><li><a href="../#Solve-Methods-1">Solve Methods</a></li><li><a href="../#DIRCOL-Method-1">DIRCOL Method</a></li></ul></ul><h1><a class="nav-anchor" id="Overview-1" href="#Overview-1">Overview</a></h1><p>The Model type holds information about the dynamics of the system. All dynamics are assumed to be state-space models of the system of the form ẋ = f(x,u) where ẋ is the state derivative, x an n-dimentional state vector, and u in an m-dimensional control input vector. The function f can be any nonlinear function.</p><p>TrajectoryOptimization.jl poses the trajectory optimization problem by discretizing the state and control trajectories, which requires discretizing the dynamics, turning the continuous time differential equation into a discrete time difference equation of the form x[k+1] = f(x[k],u[k]), where k is the time step. There many methods of performing this discretization, and TrajectoryOptimization.jl offers several of the most common methods.</p><p>Sometimes is it convenient to write down the difference equation directly, rather than running a differential equation through a discretizing integration method. TrajectoryOptimization.jl offers method deal directly with either continuous differential equations, or discrete difference equations.</p><p>The <code>Model</code> type is parameterized by the <code>DynamicsType</code>, which is either <code>Continuous</code>, or <code>Discrete</code>. The models holds the equation f and it&#39;s Jacobian, ∇f, along with the dimensions of the state and control vectors.</p><p>Models can be created by writing down the dynamics analytically or be generated from a URDF file via <a href="https://github.com/JuliaRobotics/RigidBodyDynamics.jl"><code>RigidBodyDynamics.jl</code></a>.</p><h1><a class="nav-anchor" id="Continuous-Models-1" href="#Continuous-Models-1">Continuous Models</a></h1><p>Continuous models assume differential equations are specified by an in-place function in one of the following forms:</p><pre><code class="language-none">f!(ẋ,x,u)
f!(ẋ,x,u,p)</code></pre><p>and Jacobians of the form</p><pre><code class="language-none">∇f!(Z,x,u)
∇f!(Z,x,u,p)</code></pre><p>where <code>ẋ</code> is the state derivative, <code>p</code> is a <code>NamedTuple</code> of model parameters, and <code>Z</code>is the (n × (n+m)) Jacobian matrix (i.e. [∇ₓf(x,u) ∇ᵤf(x,u)]). As soon as the model is created, however, only the forms without parameters (the top lines) are available. The <code>Model</code> type will automatically bake in the parameters. A new model must be created if a parameter is changed (this will be made easier in the future).</p><h2><a class="nav-anchor" id="Analytical-Models-1" href="#Analytical-Models-1">Analytical Models</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="TrajectoryOptimization.AnalyticalModel" href="#TrajectoryOptimization.AnalyticalModel"><code>TrajectoryOptimization.AnalyticalModel</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">struct AnalyticalModel{D} &lt;: Model{D}</code></pre><p>Dynamics model</p><p>Holds all information required to uniquely describe a dynamic system, including a general nonlinear dynamics function of the form <code>ẋ = f(x,u)</code>, where x ∈ ℜⁿ are the states and u ∈ ℜᵐ are the controls.</p><p>Dynamics function <code>Model.f</code> should be in the following forms:     &#39;f!(ẋ,x,u)&#39; and modify ẋ in place</p></div></div><a class="source-link" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/1d2ebb819ed03733c261c94ac7d2bec3784398c8/src/model.jl#L9">source</a></section><p>The following constructors can be used to create Continuous Analytical models</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="TrajectoryOptimization.Model" href="#TrajectoryOptimization.Model"><code>TrajectoryOptimization.Model</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">Model(f, n, m)
Model(f, n, m, d)
</code></pre><p>Create a dynamics model, using ForwardDiff to generate the dynamics jacobian, with parameters Dynamics function passes in parameters:     f(ẋ,x,u,p)     where p in NamedTuple of parameters</p></div></div><a class="source-link" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/1d2ebb819ed03733c261c94ac7d2bec3784398c8/src/model.jl#L75-L81">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="TrajectoryOptimization.Model" href="#TrajectoryOptimization.Model"><code>TrajectoryOptimization.Model</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">Model(f, n, m, p)
Model(f, n, m, p, d)
</code></pre><p>Create a dynamics model, using ForwardDiff to generate the dynamics jacobian, without parameters Dynamics function of the form:     f(ẋ,x,u)</p></div></div><a class="source-link" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/1d2ebb819ed03733c261c94ac7d2bec3784398c8/src/model.jl#L84-L89">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="TrajectoryOptimization.Model" href="#TrajectoryOptimization.Model"><code>TrajectoryOptimization.Model</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">Model(f, ∇f, n, m, p)
Model(f, ∇f, n, m, p, d)
</code></pre><p>Create a dynamics model with an analytical Jacobian, with parameters Dynamics functions pass in parameters:     f(ẋ,x,u,p)     ∇f(Z,x,u,p)     where p in NamedTuple of parameters</p></div></div><a class="source-link" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/1d2ebb819ed03733c261c94ac7d2bec3784398c8/src/model.jl#L92-L99">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="TrajectoryOptimization.Model" href="#TrajectoryOptimization.Model"><code>TrajectoryOptimization.Model</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">Model(f, ∇f, n, m)
Model(f, ∇f, n, m, d)
</code></pre><p>Create a dynamics model with an analytical Jacobian, without parameters Dynamics functions pass of the form:     f(ẋ,x,u)     ∇f(Z,x,u)</p></div></div><a class="source-link" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/1d2ebb819ed03733c261c94ac7d2bec3784398c8/src/model.jl#L105-L111">source</a></section><h2><a class="nav-anchor" id="URDF-Models-1" href="#URDF-Models-1">URDF Models</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="TrajectoryOptimization.RBDModel" href="#TrajectoryOptimization.RBDModel"><code>TrajectoryOptimization.RBDModel</code></a> — <span class="docstring-category">Type</span>.</div><div><div><pre><code class="language-julia">struct RBDModel{D} &lt;: Model{D}</code></pre><p>RigidBodyDynamics model. Wrapper for a RigidBodyDynamics Mechanism</p></div></div><a class="source-link" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/1d2ebb819ed03733c261c94ac7d2bec3784398c8/src/model.jl#L201">source</a></section><p>The following constructors can be used to create a Model from a URDF file</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="TrajectoryOptimization.Model-Tuple{Mechanism,Array}" href="#TrajectoryOptimization.Model-Tuple{Mechanism,Array}"><code>TrajectoryOptimization.Model</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">Model(mech, torques)
</code></pre><p>Model(mech::Mechanism, torques::Array{Bool, 1}) Constructor for an underactuated mechanism, where torques is a binary array that specifies whether a joint is actuated.</p></div></div><a class="source-link" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/1d2ebb819ed03733c261c94ac7d2bec3784398c8/src/model.jl#L216">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="TrajectoryOptimization.Model-Tuple{Mechanism}" href="#TrajectoryOptimization.Model-Tuple{Mechanism}"><code>TrajectoryOptimization.Model</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">Model(mech)
</code></pre><p>Construct model from a <code>Mechanism</code> type from <code>RigidBodyDynamics</code></p></div></div><a class="source-link" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/1d2ebb819ed03733c261c94ac7d2bec3784398c8/src/model.jl#L249">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="TrajectoryOptimization.Model-Tuple{String}" href="#TrajectoryOptimization.Model-Tuple{String}"><code>TrajectoryOptimization.Model</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">Model(urdf)
</code></pre><p>Construct a fully actuated model from a string to a urdf file</p></div></div><a class="source-link" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/1d2ebb819ed03733c261c94ac7d2bec3784398c8/src/model.jl#L259">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="TrajectoryOptimization.Model-Tuple{String,Array{Float64,1}}" href="#TrajectoryOptimization.Model-Tuple{String,Array{Float64,1}}"><code>TrajectoryOptimization.Model</code></a> — <span class="docstring-category">Method</span>.</div><div><div><pre><code class="language-julia">Model(urdf, torques)
</code></pre><p>Construct a partially actuated model from a string to a urdf file, where torques is a binary array that specifies whether a joint is actuated.</p></div></div><a class="source-link" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/1d2ebb819ed03733c261c94ac7d2bec3784398c8/src/model.jl#L266">source</a></section><h1><a class="nav-anchor" id="Discrete-Models-1" href="#Discrete-Models-1">Discrete Models</a></h1><p>Discrete models assume difference equations are specified by an in-place function in one of the following forms:</p><pre><code class="language-none">f!(x′,x,u,dt)
f!(x′,x,u,p,dt)</code></pre><p>and Jacobians of the form</p><pre><code class="language-none">∇f!(Z,x,u,dt)
∇f!(Z,x,u,p,dt)</code></pre><p>where <code>x′</code> is the state at the next time step, <code>p</code> is a <code>NamedTuple</code> of model parameters, and <code>Z</code>is the (n × (n+m)) Jacobian matrix (i.e. [∇ₓf(x,u) ∇ᵤf(x,u)]).</p><h2><a class="nav-anchor" id="Analytical-1" href="#Analytical-1">Analytical</a></h2><p>An analytical model with discrete dynamics can be created using the following constructors</p><h2><a class="nav-anchor" id="From-Continuous-Model-1" href="#From-Continuous-Model-1">From Continuous Model</a></h2><p>A discrete model can be created from a continuous model by specifying the integration (discretization) method. The following methods are currently supported</p><ul><li>midpoint</li><li>rk3 (Third Order Runge-Kutta)</li><li>rk4 (Fourth Order Runge-Kutta)</li></ul><p>Use the following method to discretize a continuous model with one of the integration methods listed previously</p><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="TrajectoryOptimization.Model-Union{Tuple{Discrete}, Tuple{Model{Continuous},Function}} where Discrete" href="#TrajectoryOptimization.Model-Union{Tuple{Discrete}, Tuple{Model{Continuous},Function}} where Discrete"><code>TrajectoryOptimization.Model</code></a> — <span class="docstring-category">Method</span>.</div><div><div><p>Convert a continuous dynamics model into a discrete one using the given discretization function.     The discretization function can either be one of the currently supported functions (midpoint, rk3, rk4) or a custom method that has the following form     <code>function discretizer(f::Function,dt::Float64)         function fd!(xdot,x,u,dt)             # Your code             return nothing         end         return fd!     end</code></p></div></div><a class="source-link" target="_blank" href="https://github.com/RoboticExplorationLab/TrajectoryOptimization.jl/blob/1d2ebb819ed03733c261c94ac7d2bec3784398c8/src/model.jl#L336">source</a></section><h1><a class="nav-anchor" id="API-1" href="#API-1">API</a></h1><pre><code class="language-none">evaluate!(ẋ::AbstractVector,model::Model,x,u)
evaluate!(Z::AbstractMatrix,ẋ::AbstractVector,model::Model,x,u)
jacobian!(Z::AbstractMatrix,ẋ::AbstractVector,model::Model,x,u)
jacobian!(Z::AbstractMatrix,model::Model,x,u)
evals(model::Model)
reset(model::Model)</code></pre><footer><hr/><a class="previous" href="../"><span class="direction">Previous</span><span class="title">TrajectoryOptimization.jl</span></a><a class="next" href="../constraints/"><span class="direction">Next</span><span class="title">Constraints</span></a></footer></article></body></html>
